![CI](https://github.com/projectriff/system/workflows/CI/badge.svg)
[![codecov](https://codecov.io/gh/projectriff/system/branch/main/graph/badge.svg)](https://codecov.io/gh/projectriff/system) 
[![Go Report Card](https://goreportcard.com/badge/github.com/projectriff/system)](https://goreportcard.com/report/github.com/projectriff/system)
[![GoDoc](https://godoc.org/github.com/projectriff/system?status.svg)](https://godoc.org/github.com/projectriff/system)

# riff System

Controllers for riff CRDs

## CRDs

riff System contains CustomResourceDefinitions that are the public API for riff.

- `streaming.projectriff.io/v1alpha1`
  - `Stream` - streams of messages
  - `Processor` - processors apply functions, containers or images to messages on streams
  - `Gateway` - stream gateway
  - `KafkaGateway` - kafka based stream gateway
  - `InMemoryGateway` - in-memory stream gateway
  - `PulsarGateway` - pulsar based stream gateway

### Runtimes

The runtime has a manager deployment that reconciles and hosts validation and defaulting webhooks for the CRDs.

### RBAC

Two ClusterRoles are defined to grant access to the riff CRDs.

- `riff-streaming-role` - read/write access to riff Streaming CRDs
- `riff-streaming-readonly-role` - read access to riff Streaming CRDs

These roles are aggregated to the `edit` and `view` ClusterRoles respectively.

See the Kuberneties [Using RBAC Authorization](https://kubernetes.io/docs/reference/access-authn-authz/rbac/) for more information.

## Install

riff System is typically not installed directly by end users. See the [Getting Started](https://projectriff.io/docs/getting-started/) docs to learn how to install riff.

## Development

riff System builds on [KubeBuilder](https://www.kubebuilder.io) which makes extensive use of generated code and configuration. After making any changes to source files in `./pkg/apis` or `./pkg/controllers` it is necessary to regenerate the API client and configuration by running:

```sh
make prepare
```

To run the unit tests locally:

```sh
make test
```

To deploy to a development cluster with [ko](https://github.com/google/ko):

```sh
ko apply --strict -f config/
```

### Dependencies

A common practice is to start with a [standard riff install](https://github.com/projectriff/charts) and then incrementally update riff System from source.

- [cert-manager](https://cert-manager.io/docs/installation/kubernetes/)
- [keda](https://github.com/kedacore/keda)

### Releases

Releases are generated by CI and published to:

> `https://storage.googleapis.com/projectriff/riff-system/riff-streaming-${version}.yaml`

## Code of Conduct

Please refer to the [Contributor Code of Conduct](CODE_OF_CONDUCT.adoc).
